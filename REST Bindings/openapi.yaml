openapi: "3.0.3"
info:
  version: 2.0.0
  title: EPCIS 2.0 REST Bindings
  license:
    name: Apache2

paths:
  /:
    options:
      summary: Query server settings, EPCIS version(s) and related vocabularies/standards.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
        - $ref: '#/components/parameters/GS1-Vendor-version'
        - $ref: '#/components/parameters/GS1-CAPTURE-limit'
        - $ref: '#/components/parameters/GS1-CAPTURE-file-size-limit'
      responses:
        '200':
          description: Server can comply with the GS1-EPCIS-related requirements from the client.
          headers:
            GS1-EPCIS-version: 
              $ref: '#/components/headers/GS1-EPCIS-version'
            GS1-EPCIS-min:
              $ref: '#/components/headers/GS1-EPCIS-min'
            GS1-EPCIS-max:
              $ref: '#/components/headers/GS1-EPCIS-max'
            GS1-CBV-version:
              $ref: '#/components/headers/GS1-CBV-version'
            GS1-EPCIS-extensions:
              $ref: '#/components/headers/GS1-EPCIS-extensions'
            GS1-Vendor-version:
              $ref: '#/components/headers/GS1-Vendor-version'
            GS1-CBV-extensions:
              $ref: '#/components/headers/GS1-CBV-extensions'
            GS1-CAPTURE-limit:
              $ref: '#/components/headers/GS1-CAPTURE-limit'
            GS1-CAPTURE-file-size-limit:
              $ref: '#/components/headers/GS1-CAPTURE-file-size-limit'
          content:
            application/json:
              schema:
                { }

  /capture:
    post:
      summary: Stores one or more EPCIS events. The server either accepts or rejects all events.
      parameters:
        - $ref: '#/components/parameters/GS1-CAPTURE-limit'
        - $ref: '#/components/parameters/GS1-CAPTURE-file-size-limit'
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
      description: >
        EPCIS events are added in bulk using the capture interface. To prevent timeouts for large payloads, the client
        potentially has to split the payload into several capture calls. To that end, the server specified a capture
        limit (number of events) and file size limit (payload size).

        A successful capturing of events does not guarantee that events will be stored. Instead, the server returns a
        capture id, which the client can use to obtain information about the capture job.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EPCISDocument'
      responses:
        '202':
          description: >
            Successfully captured one or more EPCIS events. The request returns a unique
            capture job URL in the Location header.
          headers:
            Location:
              $ref: '#/components/headers/Location'

        '400':
          description: An error occurred while capturing EPCIS events. All events are rejected.
          content:
            application/problem+json:
              schema:
                allOf:
                  - properties:
                      status:
                        type: integer
                        enum:
                          - 400
                        default: 400
                      type:
                        type: string
                        format: uri
                        enum:
                          - epcisException:ValidationException
                  - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '413':
          $ref: '#/components/responses/413QueryBodyTooLarge'

  /capture/{captureID}:
    get:
      summary: Returns information about a specific capture job.
      parameters:
        - in: path
          name: captureID
          example: /capture/id9261379075
          description: A unique value identifying a capture job generated by the server.
          required: true
          schema:
            type: string
      description: >
        This endpoint provides information about a capture job. Each time events are captured, the server generates
        a unique capture id.
      responses:
        '200':
          description: >
            If the job was successful, a list of absolute, endpoint-specific URLs of all events, in the sequence
            in which they were submitted by the client.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  format: uri
                  example:
                    - /events/ObjectEvents/oa123
                    - /events/ObjectEvents/oa345
                uniqueItems: true
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /{topLevelResource}/events:
    get:
      summary: >
        Returns all EPCIS event types currently available in the EPCIS repository, "under" the
        specified top-level resource.
      parameters:
        - $ref: '#/components/parameters/TopLevelResource'
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
      description: >
        The top-level resource endpoint helps to navigate EPCIS events by top-level resources, such as business location
        or business step. EPCIS 2.0 supports a number of optional top-level resources.
      responses:
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '200':
          $ref: '#/components/responses/200SupportedEventTypes'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /{topLevelResource}/events/{eventType}:
    get:
      summary: Returns EPCIS events of a given EPCIS event type for a specific top-level resource.
      parameters:
        - $ref: '#/components/parameters/TopLevelResource'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/EventType'
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'

      description: >
        This endpoint helps to navigate EPCIS events by EPCIS event type within a top-level resource. It returns all
        EPCIS events of a specific EPCIS event type and "under" the given top-level resource, up to the amount defined
        in perPage. The server returns a 'link' header to point to the remaining results. If the EPCIS event type is not
        needed, 'all' can be used instead of an EPCIS event type.

        Optionally, EPCIS events can be further filtered using the EPCIS query language in as query string parameters.
        In this case, ensure that the EPCIS query does not specify the top-level and only filters by
        EPCIS event type if the EPCIS event type in path is 'all'.

        Example:

        ```
        https://example.com/readPoints/urn:epc:id:sgln:4012345.00005.0/events/ObjectEvents?EQ_bizStep=urn%3Aepcglobal%3Acbv%3Abizstep%3Ashipping%2Curn%3Aepcglobal%3Acbv%3Abizstep%3Adecommissioning&GE_eventTime=2015-03-15T00%3A00%3A00.000-04%3A00
        ```

      responses:
        '200':
          $ref: '#/components/responses/200EPCISEventResponse'
        '400':
          $ref: '#/components/responses/400QueryException'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '412':
          $ref: '#/components/responses/412EventTypeMismatch'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /{topLevelResource}/events/{eventType}/{eventID}:
    get:
      summary: Returns an EPCIS event by event ID.
      parameters:
        - $ref: '#/components/parameters/TopLevelResource'
        - $ref: '#/components/parameters/EventType'
        - $ref: '#/components/parameters/EventID'
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
      description: >
        This endpoint accesses individual events "under" a top-level resource. If the EPCIS event type is not known
        or irrelevant, 'all' can be used instead of an EPCIS event type. The response body is an EPCISDocument with
        the unique event. The response body is an EPCISDocument with the unique event.
      responses:
        '200':
          $ref: '#/components/responses/200EPCISEventResponse'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /events:
    get:
      summary: Returns all EPCIS event types currently available in the EPCIS repository.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
      description: >
        EPCIS events type specifies the context of an event. This endpoint returns all EPCIS types that are
        currently in the repository.
      responses:
        '200':
          $ref: '#/components/responses/200SupportedEventTypes'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /events/{eventType}:
    get:
      summary: >
        Returns EPCIS events of a given EPCIS event type. If 'all' is used instead of an EPCIS
        event type, every event in the repository is returned.
      parameters:
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/EventType'
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
      description: >
        This endpoint returns all EPCIS events of a specific EPCIS event type up to the amount defined in perPage.
        The server returns a 'link' header to point to the remaining results.

        If the EPCIS event type is not needed, 'all' can be used instead of an EPCIS event type.

        The client can further restrict the list of events returned by filtering events using the EPCIS query
        language as URL query string parameters.

        Example:

        ```
        https://example.com/events/ObjectEvents?EQ_bizStep=urn%3Aepcglobal%3Acbv%3Abizstep%3Ashipping%2Curn%3Aepcglobal%3Acbv%3Abizstep%3Adecommissioning&GE_eventTime=2015-03-15T00%3A00%3A00.000-04%3A00
        ```

      responses:
        '200':
          $ref: '#/components/responses/200EPCISEventResponse'
        '400':
          $ref: '#/components/responses/400QueryException'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '412':
          $ref: '#/components/responses/412EventTypeMismatch'
        '414':
          $ref: '#/components/responses/414URLTooLong'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /events/{eventType}/{eventID}:
    get:
      summary: Returns an individual EPCIS event.
      parameters:
        - $ref: '#/components/parameters/EventType'
        - $ref: '#/components/parameters/EventID'
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
      description: >
        This endpoint accesses individual events using their unique id. If the EPCIS event type is not known
        or irrelevant, 'all' can be used instead of an EPCIS event type. The response body is an EPCISDocument with
        the unique event. The response body is an EPCISDocument with the unique event.
      responses:
        '200':
          $ref: '#/components/responses/200EPCISEventResponse'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries:
    get:
      summary: Returns a list of queries available to that user.
      responses:
        '200':
          description: >
            Queries are like views that are created using the EPCIS query language. Each query object
            consists of a query name and the query definition.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NamedQueryDefinition'
                uniqueItems: true
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries/{queryName}/masterdata:
    parameters:
      - $ref: '#/components/parameters/QueryName'
      - $ref: '#/components/parameters/PerPage'
    get:
      summary: Returns the result of a master data query. This endpoint supports query subscriptions.
      parameters:
        - $ref: '#/components/parameters/GS1-QUERY-minRecordTime'
        - $ref: '#/components/parameters/Upgrade'
        - $ref: '#/components/parameters/Connection'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/ReportIfEmpty'
      description: >
        The GET endpoint is to retrieve large results that don't fit into the response of a POST request.
        It can also be used to subscribe to anonymous queries.
      responses:
        '101':
         $ref: '#/components/responses/101WebsocketCreated'
        '200':
          $ref: '#/components/responses/200MasterDataResponse'
        '400':
          $ref: '#/components/responses/400QueryInvalid'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    post:
      summary: >
        Creates and executes a named EPCIS master data query and returns
        results with option to paginate if needed.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
      description: >
        Creating a named query stores a query set that can be accessed by performing
        a GET on its master data subresource. Creating a query also returns master data
        up to the amount defined in perPage. The server returns a 'link' header
        to point to the remaining results.
      requestBody:
        $ref: '#/components/requestBodies/CreateMasterDataQuery'
      responses:
        '200':
          $ref: '#/components/responses/200MasterDataResponse'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries/{queryName}:
    parameters:
      - $ref: '#/components/parameters/QueryName'
    delete:
      summary: Removes a named query and disconnects clients
      responses:
        '204':
          $ref: '#/components/responses/204QueryDeleted'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '413':
          $ref: '#/components/responses/413QueryBodyTooLarge'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries/{queryName}/events:
    parameters:
      - $ref: '#/components/parameters/QueryName'
      - $ref: '#/components/parameters/PerPage'
    get:
      summary: Returns events with option to paginate if needed. This endpoint supports query subscriptions.
      parameters:
        - $ref: '#/components/parameters/GS1-QUERY-minRecordTime'
        - $ref: '#/components/parameters/Upgrade'
        - $ref: '#/components/parameters/Connection'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/ReportIfEmpty'
      description: >
        The GET endpoint is to retrieve large results that don't fit into the response of POST request.
        It can also be used to subscribe to anonymous queries.
      responses:
        '101':
         $ref: '#/components/responses/101WebsocketCreated'
        '200':
          $ref: '#/components/responses/200EPCISEventResponse'
        '400':
          $ref: '#/components/responses/400QueryInvalid'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

    post:
      summary: Creates and executes a named EPCIS events query and returns results with option to paginate if needed.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
        - $ref: '#/components/parameters/PerPage'
      description: >
        Creating a named query creates a view on the events in the repository, accessible through it's events resource.
        Creating a query also returns events up to the amount defined in perPage. The server returns a 'link' header
        to point to the remaining results.
      requestBody:
        $ref: '#/components/requestBodies/CreateEventQuery'
      responses:
        '200':
          $ref: '#/components/responses/200EPCISEventResponse'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries/SimpleMasterDataQuery/masterdata:
    parameters:
      - $ref: '#/components/parameters/PerPage'
    post:
      summary: >
        Executes anonymous master data queries and returns results with option to paginate if needed.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
        - $ref: '#/components/parameters/GS1-QUERY-minRecordTime'
      description: >
        SimpleMasterDataQuery is an endpoint to create anonymous queries.
        A query is created once and returned to the client. Unlike name queries,
        these queries are not stored.
      requestBody:
        $ref: '#/components/requestBodies/CreateMasterDataQuery'
      responses:
        '200':
          $ref: '#/components/responses/200MasterDataResponse'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      summary: Returns the result of a master data query. This endpoint supports query subscriptions.
      parameters:
        - $ref: '#/components/parameters/GS1-QUERY-minRecordTime'
        - $ref: '#/components/parameters/Upgrade'
        - $ref: '#/components/parameters/Connection'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/ReportIfEmpty'
      description: >
        The GET endpoint is to retrieve large results that don't fit into the response of POST request.
        It can also be used to subscribe to anonymous queries.
      responses:
        '101':
         $ref: '#/components/responses/101WebsocketCreated'
        '200':
          $ref: '#/components/responses/200MasterDataResponse'
        '400':
          $ref: '#/components/responses/400QueryInvalid'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'

  /queries/SimpleEventQuery/events:
    post:
      summary: Executes anonymous EPCIS events query and returns results with option to paginate if needed.
      parameters:
        - $ref: '#/components/parameters/GS1-EPCIS-version'
        - $ref: '#/components/parameters/GS1-EPCIS-min'
        - $ref: '#/components/parameters/GS1-EPCIS-max'
        - $ref: '#/components/parameters/GS1-CBV-version'
        - $ref: '#/components/parameters/GS1-EPCIS-extensions'
        - $ref: '#/components/parameters/GS1-CBV-extensions'
        - $ref: '#/components/parameters/GS1-QUERY-minRecordTime'
      description: >
        SimpleEventQuery is an endpoint to execute anonymous queries for EPCIS events.
        A query is created once and returned to the client. Unlike named queries, these queries are not stored.
      requestBody:
        $ref: '#/components/requestBodies/CreateEventQuery'
      responses:
        '200':
          $ref: '#/components/responses/200EPCISEventResponse'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'
    get:
      summary: Returns events with option to paginate if needed. This endpoint supports query subscriptions.
      parameters:
        - $ref: '#/components/parameters/GS1-QUERY-minRecordTime'
        - $ref: '#/components/parameters/Upgrade'
        - $ref: '#/components/parameters/Connection'
        - $ref: '#/components/parameters/NextPageToken'
        - $ref: '#/components/parameters/ReportIfEmpty'
      description: >
        The GET endpoint is to retrieve large results that don't fit into the response of a POST request.
        It can also be used to subscribe to anonymous queries.
      responses:
        '101':
         $ref: '#/components/responses/101WebsocketCreated'
        '200':
          $ref: '#/components/responses/200EPCISEventResponse'
        '400':
          $ref: '#/components/responses/400QueryInvalid'
        '401':
          $ref: '#/components/responses/401AuthorizationInformationMissing'
        '403':
          $ref: '#/components/responses/403ClientUnauthorized'
        '404':
          $ref: '#/components/responses/404ResourceNotFound'
        '500':
          $ref: '#/components/responses/500ImplementationException'
components:
  responses:
    '101WebsocketCreated':
      description: Create a WebSocket connection to subscribe to queries. Upon subscription, the server SHALL send all new events to subscribing clients. If multiple clients have the same query, each client will receive events which they are authorized to see.
      headers:
        Upgrade:
          required: true
          schema:
            type: string
            default: websocket
        Connection:
          required: true
          schema:
            type: string
            default: upgrade
    200MasterDataResponse:
      headers:
        GS1-EPCIS-version:
          $ref: '#/components/headers/GS1-EPCIS-version'
        GS1-EPCIS-min:
          $ref: '#/components/headers/GS1-EPCIS-min'
        GS1-EPCIS-max:
          $ref: '#/components/headers/GS1-EPCIS-max'
        GS1-CBV-version:
          $ref: '#/components/headers/GS1-CBV-version'
        GS1-EPCIS-extensions:
          $ref: '#/components/headers/GS1-EPCIS-extensions'
        GS1-CBV-extensions:
          $ref: '#/components/headers/GS1-CBV-extensions'
        Link:
          $ref: '#/components/headers/Link'
      description: Returns the query result
      content:
        application/json:
          schema:
            type: object
            externalDocs:
              description: >
                To validate EPCIS master data, please use [JSON schema](../JSON/EPCIS-JSON-Schema.json)
                or [SHACL file](../JSON/EPCIS-SHACL.ttl).
              url: ../JSON
    200EPCISEventResponse:
      headers:
        GS1-EPCIS-version:
          $ref: '#/components/headers/GS1-EPCIS-version'
        GS1-EPCIS-min:
          $ref: '#/components/headers/GS1-EPCIS-min'
        GS1-EPCIS-max:
          $ref: '#/components/headers/GS1-EPCIS-max'
        GS1-CBV-version:
          $ref: '#/components/headers/GS1-CBV-version'
        GS1-EPCIS-extensions:
          $ref: '#/components/headers/GS1-EPCIS-extensions'
        GS1-CBV-extensions:
          $ref: '#/components/headers/GS1-CBV-extensions'
        Link:
          $ref: '#/components/headers/Link'
      description: Returns EPCIS data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EPCISDocument'
          examples:
            jsonLD:
              summary: EPCIS document in JSON-LD
              externalValue: 'https://raw.githubusercontent.com/gs1/EPCIS/master/JSON/Example_9.6.1-ObjectEvent.jsonld'
    200SupportedEventTypes:
      description: Returns all supported EPCIS event types.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EPCISEventTypes'
    '204QueryDeleted':
      description: Query deleted and clients disconnected
    '400QueryInvalid':
      description: The query is invalid
      content:
        application/json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 400
                    default: 400
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:SubscriptionControlsException
                      - epcisException:ValidationException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    '401AuthorizationInformationMissing':
      description: Authorization information is missing or invalid.
      content:
        application/problem+json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 401
                    default: 401
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:SecurityException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    '400QueryException':
      description: Query exceptions defined in EPCIS
      content:
        application/problem+json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 400
                    default: 400
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:QueryValidationException
                      - epcisException:QueryParameterException
                      - epcisException:QueryTooComplexException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    '403ClientUnauthorized':
      description: Client is unauthorized to access this resource.
      content:
        application/problem+json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 403
                    default: 403
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:SecurityException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'


    404ResourceNotFound:
      description: Either Top-level resource, event type or event ID not found
      content:
        application/problem+json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 404
                    default: 404
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:NoSuchNameException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    '412EventTypeMismatch':
      description: Mismatch of the event type constraint in the path and in the query.
      content:
        application/problem+json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 412
                    default: 412
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:QueryParameterException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    413QueryBodyTooLarge:
      description: Query body too large.
      content:
        application/problem+json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 413
                    default: 413
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:QueryTooComplexException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    '414URLTooLong':
      description: URL is too long. This is usually a problem with large EPCIS queries in the URL.
      content:
        application/problem+json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 414
                    default: 414
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:QueryTooComplexException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
    '500ImplementationException':
      description: This is a server-side problem caused when the query was resolved and executed.
      content:
        application/problem+json:
          schema:
            allOf:
              - properties:
                  status:
                    type: integer
                    enum:
                      - 500
                    default: 500
                  type:
                    type: string
                    format: uri
                    enum:
                      - epcisException:ImplementationException
              - $ref: '#/components/schemas/RFC7807ProblemResponseBody'
  schemas:
    Location:
      description: Location header of a resource
      type: string
      format: uri
      example: /events/ObjectEvents/eventId123
    RFC7807ProblemResponseBody:
      description: A response as specified in [RFC 7807](https://tools.ietf.org/html/rfc7807)
      type: object
      required:
        - type
        - title
      properties:
        type:
          type: string
          format: uri
        title:
          type: string
        status:
          type: integer
        detail:
          type: string
        instance:
          type: string
          format: uri
      example:
        type: "epcisException:SecurityException"
        title: "Unauthorized to execute query TestQuery"
        status: 401
        instance: "/queries/TestQuery"
    ReportIfEmpty:
      description: If true, a query result is always sent to the client, even if the result set is empty.
      type: boolean
    NamedQueryDefinition:
      type: object

      required:
        - name
        - query
      properties:
        name:
          $ref: '#/components/schemas/QueryName'
        query:
          $ref: '#/components/schemas/EPCISQuery'
        createdAt:
          type: string
          format: date-time
    EPCISQuery:
      type: array
      description: An EPCIS event query.
      example:
        [ {
          "eventTypes": "ObjectEvent" },
          {
            "EQ_bizStep": [
                "urn:epcglobal:cbv:bizstep:shipping",
                "urn:epcglobal:cbv:bizstep:receiving" ]
          }
        ]
      externalDocs:
        url: query-schema.json
      items:
        type: object
    QueryName:
      description: Unique query name
      type: string
      example: myQuery
    EPCISMasterDataQuery:
      type: array
      description: An EPCIS master data query.
      externalDocs:
        url: https://www.gs1.org/sites/default/files/docs/epc/EPCIS-Standard-1.2-r-2016-09-29.pdf
      items:
        type: object
    AllEvent:
      type: string
      description: A virtual EPCIS event type that is the union of all EPCIS event types.
      enum:
        - all
    EPCISDocument:
      description: A collection of EPCIS resources.
      type: object
      example:
        summary: EPCIS document in JSON-LD
        $ref: 'https://raw.githubusercontent.com/gs1/EPCIS/master/JSON/Example_9.6.1-ObjectEvent.jsonld'
      externalDocs:
        description: >
          An EPCIS document that must be validated with the [JSON schema](../JSON/EPCIS-JSON-Schema.json) or
          [SHACL file](../JSON/EPCIS-SHACL.ttl).
        url: ../JSON/EPCIS-SHACL.ttl
    Link:
      description: >
        A pagination header link. This header works together with the perPage
        and NextPageToken query string parameters
      type: string
      format: uri
      example: '<https://example.com/events/all?perPage=30&nextPageToken=3A1550673874978%2Ci%3AU6D7DENAKwM2gQRRwGrataeq>; rel="next"'
    PerPage:
      description: Parameter to control pagination. perPage specifies the maximum number of events returned in one batch.
      type: integer
      default: 30
    NextPageToken:
      description: >
        Parameter that point to the next list of results when requesting a list of events that is larger than the value
        specified with the perPage parameter.
      type: string
      example: '3A1550673874978%2Ci%3AU6D7DENAKwM2gQRRwGrataeq'
    EPCISEventTypes:
      type: string
      description: The five types of EPCIS events.
      enum:
        - ObjectEvents
        - AggregationEvents
        - AssociationEvents
        - TransformationEvents
        - TransactionEvents
    GS1-QUERY-minRecordTime:
      description: >
        An optional header to specify the smallest possible record time for
        EPCIS events in a query subscription
      type: string
      format: time
      example: "2020-04-04T20:33:31.116-06:00"

    Upgrade:
      type: string
      description: Upgrade and Connection headers are needed to open a Websocket for queries
      default: websocket
      example: websocket

    Connection:
      example: Upgrade
      description: Upgrade and Connection headers are needed to open a Websocket for queries
      type: string
      default: upgrade
    TopLevelResource:
      description: >
        A top-level resource collection, used to navigate events by EPC, "business step", "business location",
        "readpoint" or "disposition". Note that these are collections and therefore pluralized.
      type: string
      enum:
        - epcs
        - bizSteps
        - bizLocations
        - readPoints
        - dispositions

    # describe header schema
    GS1-EPCIS-version:
      description: The EPCIS version
      type: string
      pattern: ^\d+(\.\d+)?$
      example: "2.0"
    GS1-EPCIS-min:
      description: The lowest EPCIS version supported
      type: string
      pattern: ^\d+(\.\d+)?$
      example: "2.0"
    GS1-EPCIS-max:
      description: The highest EPCIS version supported
      type: string
      pattern: ^\d+(\.\d+)?$
    GS1-CBV-version:
      description: The core business vocabulary version
      type: string
    GS1-EPCIS-extensions:
      description: Specific EPCIS extensions supported (e.g. for FIT)
      type: string
    GS1-Vendor-version:
      description: A versioning scheme that can be freely chosen by the vendor
      type: array
      items:
        type: string
      uniqueItems: true
    GS1-CBV-extensions:
      description: An optional header to specify the vocabulary for the top-level endpoints
      type: array
      items:
        type: string
      uniqueItems: true
    GS1-CAPTURE-limit:
      description: The maximum number of EPCIS events that can be captured per call
      type: string
      pattern: ^(\d+|\*)$
    GS1-CAPTURE-file-size-limit:
      description: The maximum event document length in octets (8-bit bytes)
      type: string
      pattern: ^(\d+|\*)$

  parameters:
    PerPage:
      in: query
      name: perPage
      schema:
        $ref: '#/components/schemas/PerPage'
    NextPageToken:
      in: query
      name: nextPageToken
      schema:
        $ref: '#/components/schemas/NextPageToken'
    ReportIfEmpty:
      in: query
      name: reportIfEmpty
      required: false
      schema:
        $ref: '#/components/schemas/ReportIfEmpty'
    GS1-QUERY-minRecordTime:
      in: header
      name: GS1-QUERY-minRecordTime
      required: false
      schema:
        $ref: '#/components/schemas/GS1-QUERY-minRecordTime'
    Upgrade:
      in: header
      name: Upgrade
      required: false
      schema:
        $ref: '#/components/schemas/Upgrade'
    Connection:
      in: header
      name: Connection
      required: false
      schema:
        $ref: '#/components/schemas/Upgrade'

    EventID:
      name: eventID
      in: path
      description: >
        The ID of an EPCIS event. Because of the 'all' reserved value for EPCIS events types,
        an EPCIS event ID must be unique.
      required: true
      example: "_:event1"
      schema:
        type: string
    EventType:
      name: eventType
      in: path
      required: true
      description: >
        Names of EPCIS event types plus the reserved name 'all',
        which is the union of all EPCIS event types
      schema:
        oneOf:
          - $ref: '#/components/schemas/EPCISEventTypes'
          - $ref: '#/components/schemas/AllEvent'
    QueryName:
      in: path
      name: queryName
      required: true
      schema:
        $ref: '#/components/schemas/QueryName'
    TopLevelResource:
      in: path
      name: topLevelResource
      required: true
      schema:
        type: string
        enum:
          - epcs
          - bizSteps
          - bizLocations
          - readPoints
          - dispositions

    # request headers from schema
    GS1-EPCIS-version:
      in: header
      name: GS1-EPCIS-version
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-version'
    GS1-EPCIS-min:
      in: header
      name: GS1-EPCIS-min
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-min'
    GS1-EPCIS-max:
      in: header
      name: GS1-EPCIS-max
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-max'
    GS1-CBV-version:
      in: header
      name: GS1-CBV-version
      schema:
        $ref: '#/components/schemas/GS1-CBV-version'
    GS1-EPCIS-extensions:
      in: header
      name: GS1-EPCIS-extensions
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-extensions'
    GS1-Vendor-version:
      in: header
      name: GS1-Vendor-version
      schema:
        $ref: '#/components/schemas/GS1-Vendor-version'
    GS1-CBV-extensions:
      in: header
      name: GS1-CBV-extensions
      schema:
        $ref: '#/components/schemas/GS1-CBV-extensions'
    GS1-CAPTURE-limit:
      in: header
      name: GS1-CAPTURE-limit
      schema:
        $ref: '#/components/schemas/GS1-CAPTURE-limit'
    GS1-CAPTURE-file-size-limit:
      in: header
      name: GS1-CAPTURE-file-size-limit
      schema:
        $ref: '#/components/schemas/GS1-CAPTURE-file-size-limit'

  headers:

    # response headers from schema
    GS1-EPCIS-version:
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-version'
    GS1-EPCIS-min:
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-min'
    GS1-EPCIS-max:
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-max'
    GS1-CBV-version:
      schema:
        $ref: '#/components/schemas/GS1-CBV-version'
    GS1-EPCIS-extensions:
      schema:
        $ref: '#/components/schemas/GS1-EPCIS-extensions'
    GS1-Vendor-version:
      schema:
        $ref: '#/components/schemas/GS1-Vendor-version'
    GS1-CBV-extensions:
      schema:
        $ref: '#/components/schemas/GS1-CBV-extensions'
    GS1-CAPTURE-limit:
      schema:
        $ref: '#/components/schemas/GS1-CAPTURE-limit'
    GS1-CAPTURE-file-size-limit:
      schema:
        $ref: '#/components/schemas/GS1-CAPTURE-file-size-limit' 

    Location:
      schema:
        $ref: '#/components/schemas/Location'
    GS1-QUERY-minRecordTime:
      schema:
        $ref: '#/components/schemas/GS1-QUERY-minRecordTime'
    Link:
      schema:
        $ref: '#/components/schemas/Link'
  requestBodies:
    CreateEventQuery:
      description: Creates and executes an events query
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EPCISQuery'
    CreateMasterDataQuery:
      description: Creates and executes a master data query
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EPCISMasterDataQuery'

